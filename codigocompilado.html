<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comunidade Sênior</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        .postagem-info {
            background-color: rgba(173, 216, 230, 0.7);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
        }

        .postagem-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .postagem-usuario i {
            margin-right: 5px;
        }

        .comentario-info {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            margin-left: 80px;
        }

        .comentario-info i {
            margin-right: 5px;
        }

        .comentario-usuario i {
            margin-right: 5px;
        }

        .comentario-texto {
            margin-left: 20px;
        }

        .comentario-icon-usuario,
        .comentario-nome-usuario {
            color: #97694F;
        }

        .comment-box {
            margin-left: 10px;
            width: calc(100% - 30px);
        }

        .formulario-pesquisa {
            margin-bottom: 100px;
            margin-top: 100px;
        }

        @media (min-width: 992px) {
            .navbar-nav .nav-link {
                font-size: 20px;
            }
        }

        .dropdown-menu .dropdown-item {
        color: white;
        }
        .dropdown-menu .dropdown-item:focus,
        .dropdown-menu .dropdown-item:hover {
            background-color: #3385ff;
        }
        .dropdown-menu {
            background-color: #3385ff;
        }

        .navbar {
        background-color: #3385ff !important
          }

    </style>
</head>

<body class="d-flex flex-column vh-100">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary" style="background-color: rgba(0, 123, 255, 0.7);">
        <div class="container-fluid">
            <!-- Ícone à esquerda -->
            <a class="navbar-brand" href="#">
                <img src="mini_logo_cortada.png" alt="Ícone" width="45" height="45">
            </a>
            <!-- Botão de toggler para telas pequenas -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- Itens da barra de navegação -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#">Início</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Notícias</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Tecnologia</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Desafios</a></li>
                    <li class="nav-item"><a class="nav-link active" href="#">Comunidade</a></li>
                    <div class="dropdown">
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#">Cursos</a>
                            <ul class="dropdown-menu">
                                <li><a href="#" class="dropdown-item">Finanças</a></li>
                                <li><a href="#" class="dropdown-item">Artesanato</a></li>
                                <li><a href="#" class="dropdown-item">Jardinagem</a></li>
                                <li><a href="#" class="dropdown-item">Literatura</a></li>
                                <li><a href="#" class="dropdown-item">Inglês</a></li>
                            </ul>
                        </li>
                    </div>
                    <li class="nav-item"><a class="nav-link" href="#"><i class="fas fa-user me-1"></i>Entrar</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" id="limparLocalStorage"
                            style="color: orangered">Limpeza Local</a></li>
                </ul>
            </div>
        </div>
    </nav>    

    <!-- Capa -->
    <div class="container-fluid p-0">
        <img src="imagem_comunidade.png" alt="Imagem de capa" class="img-fluid w-100"
            style="width: 500px; max-height: 65vh; object-fit: cover;">
    </div>

    <!-- Conteúdo da Comunidade -->
    <div class="container mt-5 flex-grow-1">
        <div class="col text-center mb-5">
            <h1 class="display-5 fw-bold">Compartilhe suas experiências com outros usuários!</h1>
        </div>

        <!-- Filtro de postagens -->
        <div id="formPesquisa" class="formulario-pesquisa">
            <form class="d-flex mx-auto mb-3">
                <input class="form-control me-2" type="search" placeholder="Pesquisar Assunto" aria-label="Pesquisar">
                <button class="btn btn-outline-primary" type="submit">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>

        <!-- Formulário de Postagem -->
        <form id="postForm">
            <div class="mb-3">
                <label for="titulo" class="form-label fs-4">Assunto da Postagem</label>
                <input type="text" class="form-control fs-4" id="titulo" required>
            </div>
            <div class="mb-3">
                <label for="conteudo" class="form-label fs-4">Conteúdo da Postagem</label>
                <textarea class="form-control fs-4" id="conteudo" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary btn-lg">Enviar</button>
        </form>

        <!-- Exibição de Postagens -->
        <div id="postagens" class="mt-5"></div>
    </div>

    <!-- Rodapé -->
    <footer class="footer mt-auto py-3 bg-light">
        <div class="container text-center">
            <span class="text-muted">Direitos reservados a SêniorConnect - 2024</span>
            <a href="https://www.seniorconnect.com.br" style="color: #333;">Visite nosso site</a>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Função para exibir postagens armazenadas
            function exibirPostagens(termoPesquisa) {
                var postagens = JSON.parse(localStorage.getItem('postagens')) || [];

                // Filtrar postagens com base no termo de pesquisa, se fornecido
                if (termoPesquisa) {
                    postagens = postagens.filter(postagem =>
                        postagem.titulo.toLowerCase().includes(termoPesquisa.toLowerCase())
                    );
                }    
                // Ordenar postagens por ordem decrescente de data
                postagens.sort((a, b) => new Date(b.data) - new Date(a.data));

                var postagensHtml = '';

                postagens.forEach(function (postagem, index) {
                    postagensHtml += `
            <div class="postagem" data-index="${postagem.id}">
                <div class="postagem-info">
                    <h3>${postagem.titulo}</h3>
                    <p>${postagem.conteudo}</p>
                    <div class="postagem-footer">
                        <span class="postagem-usuario"><i class="fas fa-user"></i> ${postagem.nomeUsuario}</span>
                        <span class="postagem-data">${postagem.data}</span>
                    </div>
                    <div class="btn-group mt-3" role="group" aria-label="Botões de like e dislike">
                        <button type="button" class="btn btn-outline-success like-btn"><i class="fas fa-arrow-up"></i></button>
                        <button type="button" class="btn btn-outline-danger dislike-btn"><i class="fas fa-arrow-down"></i></button>
                    </div>
                    <span class="badge bg-success">Likes: <span class="likes-count">${postagem.likes || 0}</span></span>
                </div>
                <div class="mb-3">
                    <label for="comentario-${postagem.id}" class="form-label">Comentário</label>
                    <input type="text" class="form-control comment-box" id="comentario-${postagem.id}" placeholder="Digite seu comentário">
                </div>
                <button type="button" class="btn btn-primary btn-sm enviar-comentario" data-index="${postagem.id}">Enviar Comentário</button>
                <div class="comentarios mt-3">
                    ${exibirComentarios(postagem.comentarios)}
                </div>
            </div>
        `;
                });

                document.getElementById('postagens').innerHTML = postagensHtml;
            }

            <!--
            // Função para adicionar like a uma postagem
            function adicionarLike(postagemId) {
                var postagens = JSON.parse(localStorage.getItem('postagens')) || [];
                var postagem = postagens[postagemId];

                // Verificar se o usuário já deu like
                if (!postagem.likesGiven || !postagem.likesGiven.includes('user01')) { // Substitua 'user123' pelo identificador do usuário
                    postagem.likes = (postagem.likes || 0) + 1;
                    postagem.likesGiven = postagem.likesGiven || [];
                    postagem.likesGiven.push('user01'); // Registrar que o usuário deu like
                    updateLikes(postagemId, postagem.likes);
                } else {
                    alert('Você já deu like nesta postagem.');
                }
            }
            // Função para adicionar dislike a uma postagem
            function adicionarDislike(postagemId) {
                var postagens = JSON.parse(localStorage.getItem('postagens')) || [];
                var postagem = postagens[postagemId];

                // Verificar se o usuário já deu dislike
                if (!postagem.dislikesGiven || !postagem.dislikesGiven.includes('user02')) { // Substitua 'user123' pelo identificador do usuário
                    postagem.likes = (postagem.likes || 0) - 1;
                    postagem.dislikesGiven = postagem.dislikesGiven || [];
                    postagem.dislikesGiven.push('user01'); // Registrar que o usuário deu dislike
                    updateLikes(postagemId, postagem.likes);
                } else {
                    alert('Você já deu dislike nesta postagem.');
                }
            }
            -->

            // Lista fictícia de usuários
            var usuarios = [
                { id: 'user01', nome: 'Marcelo User'},
                { id: 'user02', nome: 'Aline User'},
                { id: 'user03', nome: 'Olavo User'},
                { id: 'user04', nome: 'Maria User'},
                { id: 'user05', nome: 'Gilsileine User'}
            ];

            // Função para adicionar um usuário fictício ao localStorage
            function adicionarUsuariosFicticios() {
                localStorage.setItem('usuarios', JSON.stringify(usuarios));
            }

            // Chamada da função para adicionar os usuários fictícios
            adicionarUsuariosFicticios();

            // adicionarLike(postagemId, usuarios[0].id); // Para adicionar like do 'Usuário 1'
            // adicionarDislike(postagemId, usuarios[1].id); // Para adicionar dislike do 'Usuário 2'


            // Função para exibir os comentários
            function exibirComentarios(comentarios) {
                if (!comentarios || comentarios.length === 0) return '';

                return comentarios.map(comentario => `
                    <div class="comentario-info">
                        <div class="comentario-usuario">
                            <i class="fas fa-user comentario-icon-usuario"></i>
                            <span class="comentario-nome-usuario">${comentario.nomeUsuario}</span>
                        </div>
                        <div class="comentario-texto">${comentario.texto}</div>
                    </div>
                `).join('');
            }

            function gerarId() {
                var randomGuid = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g, function (c) {
                    var r = Math.random() * 16 | 0;
                    var v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
                return randomGuid;
            }

            // Função para adicionar uma nova postagem
            function adicionarPostagem(nomeUsuario, titulo, conteudo) {
                var postagens = JSON.parse(localStorage.getItem('postagens')) || [];

                postagens.push({
                    id: gerarId() ,
                    nomeUsuario: nomeUsuario,
                    titulo: titulo,
                    conteudo: conteudo,
                    likes: 0,
                    data: new Date().toLocaleString()
                });

                localStorage.setItem('postagens', JSON.stringify(postagens));
            }

            // Função para limpar o formulário
            function limparFormulario() {
                document.getElementById('titulo').value = '';
                document.getElementById('conteudo').value = '';
            }

            // Função para atualizar o número de likes de uma postagem
            function updateLikes(postagemId, likes) {
                var postagens = JSON.parse(localStorage.getItem('postagens')) || [];

                postagens.find(x => x.id === postagemId).likes = likes;

                localStorage.setItem('postagens', JSON.stringify(postagens));
                exibirPostagens();
            }

            // Função para limpar o armazenamento local
            function limparLocalStorage() {
                localStorage.removeItem('postagens');
                exibirPostagens();
            }

            // Exibir postagens ao carregar a página
            exibirPostagens();

             // Adicionar evento de envio para o formulário de pesquisa
            document.getElementById('formPesquisa').addEventListener('submit', function (event) {
                event.preventDefault();
                var termoPesquisa = document.querySelector('#formPesquisa input[type="search"]').value.trim();
                exibirPostagens(termoPesquisa);  
                
            });

            // Adicionar evento de envio para o formulário
            document.getElementById('postForm').addEventListener('submit', function (event) {
                event.preventDefault();

                var nomeUsuario = "Usuário"; // Nome temporário
                var titulo = document.getElementById('titulo').value;
                var conteudo = document.getElementById('conteudo').value;

                adicionarPostagem(nomeUsuario, titulo, conteudo);
                exibirPostagens();
                limparFormulario();
            });

            // Adicionar evento de clique para limpar o armazenamento local
            document.getElementById('limparLocalStorage').addEventListener('click', limparLocalStorage);

            // Adicionar evento de clique para os botões de like e dislike
            document.getElementById('postagens').addEventListener('click', function (event) {
                if (event.target.classList.contains('like-btn')) {
                    var postagemId = event.target.closest('.postagem').dataset.index;
                    var postagens = JSON.parse(localStorage.getItem('postagens')) || [];
                    var likes = postagens.find(x => x.id === postagemId).likes || 0;
                    likes++;
                    updateLikes(postagemId, likes);
                }
                if (event.target.classList.contains('dislike-btn')) {
                    var postagemId = event.target.closest('.postagem').dataset.index;
                    var postagens = JSON.parse(localStorage.getItem('postagens')) || [];
                    var likes = postagens.find(x => x.id === postagemId).likes || 0;
                    likes--;
                    updateLikes(postagemId, likes);
                }
                if (event.target.classList.contains('enviar-comentario')) {
                    var postagemId = event.target.dataset.index;
                    var comentario = document.getElementById(`comentario-${postagemId}`).value;
                    var postagens = JSON.parse(localStorage.getItem('postagens')) || [];
                    if (!postagens.find(x => x.id === postagemId).comentarios) postagens.find(x => x.id === postagemId).comentarios = [];
                    postagens.find(x => x.id === postagemId).comentarios.push({
                        nomeUsuario: "Usuário", // Nome temporário
                        texto: comentario
                    });
                    localStorage.setItem('postagens', JSON.stringify(postagens));
                    exibirPostagens();
                }               
            });
        });
    </script>
</body>
</html>
